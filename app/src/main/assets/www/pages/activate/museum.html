<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>博物馆</title>
    <!--<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>-->
    <meta http-equiv="Content-Type" content="text/html; charset=GBK">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <!--兼容iphone-->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="../../assets-wiki/js/flexible.min.js?t=201807311146"></script>
    <link rel="icon" type="image/x-icon" href="../../assets-wiki/images/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="../../assets-wiki/css/museum.css?t=201807311146">
    <script src="../../assets-wiki/js/vue.min.js?t=201807311146"></script>
    <script src="../../assets-wiki/js/jquery.min.js?t=201807311146"></script>

    <!--懒加载-->
    <script src="../../assets-wiki/js/jquery.lazyload.min.js?t=201807311146"></script>

    <!-- 轮播图 -->
    <script src="../../assets-wiki/js/swiper.min.js?t=201807311146"></script>

    <!--资讯组件-->
    <script src="../../assets-wiki/js/tpls.js?t=201807311146"></script>





    <!--基本信息数据-->
    <script src="../../assets-wiki/data/dictionary.js?t=201807311146"></script>
    <script src="../../assets-wiki/data/category.js?t=201807311146"></script>

    <!--接口-->
    <script src="../../assets-wiki/js/utils.js?t=201807311146"></script>
    <script src="../../assets-wiki/js/myApp.js?t=201807311146"></script>

    <!--传承人数据-->
    <script src="../../pages/ency/ency-model.js?t=201807311146"></script>

    <!--活动组件-->
    <!--<script src="/assets-wiki/tpls/activicy-tpl.js?t=201807311146"></script>-->




    <!--百科数据交互-->
    <script src="model.js?t=201807311146"></script>

</head>
<body>
<div class="box" id="app" v-cloak>

    <!--无网络状态导航-->
    <no-watch-head v-if="load_msg.networkMsg && head.h5head"></no-watch-head>

    <div id="mescroll">
        <!--app导航-->
        <app-share-tip v-if="head.apphead"></app-share-tip>
        <!-- 返回上一级 -->
        <Re-Datails :datas="share_content" v-if="head.h5head" :class="{active1: load_msg.returnMsg}"></Re-Datails>
        <!--左右按钮  -->
        <Btn-Datails :leri="leri" @btn-left="btnLeft" @btn-right="btnRight"  :num="objData.diaSpage" :class="{active: load_msg.btn_msg}"></Btn-Datails>



        <!--交互-->
        <div class="content">
            <!--banner-->
            <Ban-Datails :dowm="dowm" :datas="bannerData"></Ban-Datails>

            <!-- 推荐传承人人物 "mmend.length"-->
            <div class="mmend" v-if="mmend.length > 0">
                <!-- 推荐传承人 -->
                <h3 class="init_title active">推荐传承人</h3>
                <div class="mmend_list">
                    <div class="swiper-container_mmend">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" v-for="item in mmend">
                                <a :href="item.id">
                                    <i v-if="item.imgUrl">
                                        <img  class="lazy" :data-original="item.imgUrl" alt="">
                                        <em v-if="item.vUrl">
                                            <img :src="item.vUrl" alt="">
                                        </em>
                                    </i>
                                    <p v-if="item.title">{{item.title}}</p>
                                </a>
                            </div>

                        </div>
                    </div>
                </div>



            </div>

            <!-- 展示 -->
            <div class="master_detail">

                <div class="detail_list">
                    <!-- 频道分类 -->
                    <pics-list @code-id="btnpin" :update="update" :datas="dataList"></pics-list>

                </div>

                <div class="master_content">


                    <!--百科  -->
                    <div class="detail_content" v-show="ency">
                        <!-- 标题人物 -->
                        <mu-title :musetitle="musetitle"></mu-title>

                        <!-- 代表性传承人 -->
                        <in-herit :inherit="init"></in-herit>

                        <!-- 非遗在中国 -->
                        <efei-china :China="China"></efei-china>

                        <!--基本信息-->
                        <info-datails :datas="info"></info-datails>

                        <!--图片  视频  内容-->
                        <bas-datails :datas="basData" @show-area="imgSet" @show-id="_dataId"></bas-datails>

                        <!--菜单按钮-->
                        <bt-nmenu :datas="listmenu"></bt-nmenu>

                    </div>

                    <!--教学-->
                    <div class="teach_content" v-show="teac">
                        <teac-hing :reset="reset"></teac-hing>
                        <div class="btnwork" v-if="teacMsg">
                            <p v-if="teacStatus == false">已加载到底部</p>
                            <p v-if="teacStatus == true" @click="btnTeac">点击加载 <a href="javascript:;">下一页</a></p>
                        </div>
                    </div>

                    <div class="shop_activity" v-show="acti">
                        <!--活动-->
                        <wk-activity :activity="actiladd"></wk-activity>
                        <div class="btnwork" v-if="actiMsg">
                            <p v-if="consActiva == false">已加载到底部</p>
                            <p v-if="consActiva == true" @click="btnActi">点击加载 <a href="javascript:;">下一页</a></p>
                        </div>
                    </div>

                    <!--资讯-->
                    <div class="detail_cons" v-show="cons">
                        <news-item :data="newsData"></news-item>
                        <div class="btnwork" v-if="consMsg">
                            <p v-if="consStatus == false">已加载到底部</p>
                            <p v-if="consStatus == true" @click="btnCons">点击加载 <a href="javascript:;">下一页</a></p>
                        </div>
                    </div>


                    <!--体验馆-->
                    <div class="teach_content" v-show="expe">
                        <teac-hing :reset="reset"></teac-hing>
                        <div class="btnwork" v-if="expeMsg">
                            <p v-if="expeStatus == false">已加载到底部</p>
                            <p v-if="expeStatus == true" @click="btnExpe">点击加载 <a href="javascript:;">下一页</a></p>
                        </div>
                    </div>

                    <div v-show="inhe">
                        <!--传承人-->
                        <wk-ency :datas="hertor" :recommend="true"></wk-ency>
                        <div class="btnwork" v-if="inheMsg">
                            <p v-if="inheStatus == false">已加载到底部</p>
                            <p v-if="inheStatus == true" @click="btnInhe">点击加载 <a href="javascript:;">下一页</a></p>
                        </div>
                    </div>


                    <!--列表正在加载-->
                    <list-load :state="state"></list-load>

                </div>




            </div>

            <!-- 图集展示区域 -->
            <atl-area :area="area" :urlset="urlset" @child-say="imgSet"></atl-area>

            <!--返回顶部-->
            <return-bas></return-bas>




        </div>

    </div>


    <!--正在加载-->
    <shop-load :msg="msg" :class="{active: load_msg.shopMsg}"></shop-load>
    <!--无网络加载状态-->
    <no-network v-if="load_msg.networkMsg"></no-network>

</div>


<script src="../../assets-wiki/js/shop-details.js?t=20180830"></script>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            urlIp: api.getList,                //百科 接口
            urlId: api.targetId,         //banner获取详情
            allChannelIp: api.parentId,  //作品/资讯 接口

            objData:{                 //参数
                id: "",               //百科ID
                page: "",               //作品、资讯页数
                diaSpage:"",          //百科页数
                num: "",              //数量/页
                atlasId: null,           //当前点击图文的ID
                msg:"",                  //是否存在id  获取单个详情 还是分页详情
            },






            ency: true,       //百科
            teac: false,      //教学
            acti: false,      //活动
            cons: false,      //咨询
            expe: false,      //体验馆
            inhe: false,      //传承人





            basModelId:"",     //当前博物馆的id
            masStatus: "",    //子频道是否累加状态1 2 3


            //教学
            teacStatus: true,   //load显示状态   true--有数据   fasle--无数据
            teacMsg: false,     //load是否显示
            //活动
            consActiva: true,   //load显示状态   true--有数据   fasle--无数据
            actiMsg: false,     //load是否显示
            //资讯
            consStatus: true,   //load显示状态   true--有数据   fasle--无数据
            consMsg: false,     //load是否显示
            //体验馆
            expeStatus: true,   //load显示状态   true--有数据   fasle--无数据
            expeMsg: false,     //load是否显示
            //传承人
            inheStatus: true,   //load显示状态   true--有数据   fasle--无数据
            inheMsg: false,     //load是否显示

            msg: false,        //默认正在加载状态
            state: false,      //列表正在加载
            dowm: true,       //下拉按钮状态
            leri: true,       //左右按钮状态
            total:"",         //所有的数据条数
            bannerData:"",    //banner题图数据
            mmend:"",         //推荐传承人
            musetitle:"",     //标题
            China:"",         //非遗在中国
            info:"",          //基本信息
            basData:"",    //视频 图片 内容
            listmenu:"",      //菜单列表数据
            area: false,     //图集展示状态
            urlset: "",      //图集数据



            //代表性传承人
            init:{
                inher:[]
            },
            //频道数据
            dataList:[
                {"name":"百科", "code_id": 1, "ivmsg": true},
//                {"name":"教学", "code_id": 2, "ivmsg": false},
                {"name":"活动", "code_id": 3, "ivmsg": false},
                {"name":"资讯", "code_id": 4, "ivmsg": false},
                {"name":"体验馆", "code_id": 5, "ivmsg": false},
                {"name":"传承人", "code_id": 6, "ivmsg": false}
            ],

            update: 1,

            //教学、体验馆
            reset:[],
            //资讯
            newsData: [],
            //传承人
            hertor:[],
            //活动数据
            actiladd: [],

            //记录禁止滚动前的高度   禁止滚动时使用
            hiddenTop: 0,
            //重新赋值的高度   解除禁止滚动使用
            showTop: 0,


            //ios Android分享内容
            share_content: {
                title: "",
                imageUrl: "",
                content: "",
                htmlUrl: ""
            },

            //导航状态
            head:{
                addhead: false,    //分享后的导航
                h5head: true    //原导航
            },

            // 有无网络状态
            load_msg :{
                networkMsg: false,  // 无网络状态
                shopMsg: false,     // load z-index
                btn_msg: false,    // 左右按钮z-index
                returnMsg: false   //返回上一级 z-index
            }

        },
        components:{
            btNmenu: btNmenu,             //菜单按钮
            ReDatails: ReDatails,         //返回上一级 按钮
            BtnDatails: BtnDatails,       //左右按钮
            BanDatails: BanDatails,       //banner题图
            PicsList: PicsList,           //频道分类
            muTitle:muTitle,              //标题人物
            inHerit:inHerit,              //代表性传承人
            efeiChina:efeiChina,          //非遗在中国
            InfoDatails: InfoDatails,     //基本模板
            BasDatails: BasDatails,        //图片 视频 文本内容
            teacHing: teacHing,           //体验馆、教学
            atlArea: atlArea,              //图片、视频展示图集
            newsItem: newsItem,            //资讯
            wkEncy:wkEncy,                  //传承人
            wkActivity:wkActivity,          //活动
            shopLoad:shopLoad,             //正在加载
            listLoad:listLoad,              //列表正在加载
            returnBas: returnBas,           //返回顶部
            appShareTip: appShareTip,    //app导航
            noNetwork: noNetwork,   //无网络加载状态
            noWatchHead: noWatchHead   //无网络状态导航
        },
        methods: {

            //存储当前显示的页数   刷新当前页面
            _refresh: function () {
                localStorage.setItem("diaSpage",this.objData.diaSpage);
            },
            //获取的页数   刷新当前页面
            _initAll: function(){
                this.objData.diaSpage = localStorage.getItem("diaSpage") ? parseInt(localStorage.getItem("diaSpage")) : 1;
            },

            //接受图集展示的状态
            imgSet(res){
              this.area = res;
                if(this.area == true){
                    this.showTop = this.hiddenTop;
                    this.hidden(this.hiddenTop);
                }else{

                    this.show(this.showTop);
                }
            },

            //点击切换频道内容
            btnpin(id){
                switch (id){
                    case 1:          //百科
                        this.default_channel(0);

                        this._initAll();          //点击百科取客户端缓存页数值
                        this.objData.id = 9;      //博物馆id = 9
                        this.objData.num = 1;     //百科显示数据量为 1
                        this._swiperData(this);
                        break;
                    case 2:          //教学
                        this.default_channel(1);
                        this.ency = false;       //百科
                        this.teac = true;        //教学
                        this.acti = false;       //活动
                        this.cons = false;       //咨询
                        this.expe = false;       //体验馆
                        this.inhe = false;       //传承人
                        this.dataList.forEach(function (val, index) {
                            if(val.code_id == 2){
                                val.ivmsg = true;
                            }else{
                                val.ivmsg = false;
                            }
                        })

                        this.objData.id = 16;
                        this.objData.page = 1;
                        this.objData.num = 5;
                        this.masStatus = 2;   //不累加
                        this._getReset(this.objData);
                        break;
                    case 3:          //活动
                        this.default_channel(2);
                        this.ency = false;       //百科
                        this.teac = false;       //教学
                        this.acti = true;        //活动
                        this.cons = false;       //咨询
                        this.expe = false;       //体验馆
                        this.inhe = false;       //传承人
                        this.dataList.forEach(function (val, index) {
                            if(val.code_id == 3){
                                val.ivmsg = true;
                            }else{
                                val.ivmsg = false;
                            }
                        })

                        this.objData.id = 17;
                        this.objData.page = 1;
                        this.objData.num = 5;
                        this.masStatus = 2;   //不累加
                        this._getActiva(this.objData);
                        break;
                    case 4:          //资讯
                        this.default_channel(3);
                        this.ency = false;       //百科
                        this.teac = false;       //教学
                        this.acti = false;       //活动
                        this.cons = true;        //咨询
                        this.expe = false;       //体验馆
                        this.inhe = false;       //传承人
                        this.dataList.forEach(function (val, index) {
                            if(val.code_id == 4){
                                val.ivmsg = true;
                            }else{
                                val.ivmsg = false;
                            }
                        })

                        this.objData.id = 18;
                        this.objData.page = 1;
                        this.objData.num = 5;
                        this.masStatus = 2;   //不累加

                        this._getNewsData(this.objData);
                        break;
                    case 5:         //体验馆
                        this.default_channel(4);
                        this.ency = false;       //百科
                        this.teac = false;       //教学
                        this.acti = false;       //活动
                        this.cons = false;       //咨询
                        this.expe = true;      //体验馆
                        this.inhe = false;       //传承人
                        this.dataList.forEach(function (val, index) {
                            if(val.code_id == 5){
                                val.ivmsg = true;
                            }else{
                                val.ivmsg = false;
                            }
                        })

                        this.objData.id = 19;
                        this.objData.page = 1;
                        this.objData.num = 5;
                        this.masStatus = 2;   //不累加
                        this._getExper(this.objData);
                        break;
                    case 6:         //传承人
                        this.default_channel(5);
                        this.ency = false;       //百科
                        this.teac = false;       //教学
                        this.acti = false;       //活动
                        this.cons = false;       //咨询
                        this.expe = false;       //体验馆
                        this.inhe = true;        //传承人
                        this.dataList.forEach(function (val, index) {
                            if(val.code_id == 6){
                                val.ivmsg = true;
                            }else{
                                val.ivmsg = false;
                            }
                        })

                        this.objData.id = 20;
                        this.objData.page = 1;
                        this.objData.num = 5;
                        this.masStatus = 2;   //不累加
                        this._gethertor(this.objData);
                        break;
                }
            },

            //点击资讯加载更多显示下一页数据
            btnCons: function () {
                this.objData.page++;
                this.objData.id = 18;
                this.objData.num = 5;
                this.masStatus = 1;    //累加
                this._getNewsData(this.objData);
            },

            //点击教学加载更多显示下一页数据
            btnTeac: function () {
                this.objData.page++;
                this.objData.id = 16;
                this.objData.num = 5;
                this.masStatus = 1;    //累加
                this._getReset(this.objData);
            },
            //点击体验馆加载更多显示下一页数据
            btnExpe: function () {
                this.objData.page++;
                this.objData.id = 19;
                this.objData.num = 5;
                this.masStatus = 1;    //累加
                this._getExper(this.objData);
            },
            //点击活动加载更多显示下一页数据
            btnActi: function () {
                this.objData.page++;
                this.objData.id = 17;
                this.objData.num = 5;
                this.masStatus = 1;    //累加
                this._getActiva(this.objData);
            },
            //传承人加载更多显示下一页
            btnInhe: function () {
                this.objData.page++;
                this.objData.id = 20;
                this.objData.num = 5;
                this.masStatus = 1;    //累加
                this._gethertor(this.objData);
            },


            //左按钮事件页数--
            btnLeft: function (numBer) {
                this.objData.diaSpage = numBer;
                this.objData.diaSpage < 1 ? this.objData.diaSpage = this.total : this.objData.diaSpage;
                this.objData.id = 9;      //传承人馆id = 8
                this.objData.num = 1;     //百科显示数据量为 1
                this._swiperData(this);  //页面加载完数据执行swiper
//                console.log(this.objData.diaSpage);
                //客户端存储num值   刷新当前页面
                this._refresh();
            },

            //右按钮事件页数++
            btnRight: function (numBer) {
                this.objData.diaSpage = numBer;
                this.objData.diaSpage > this.total ? this.objData.diaSpage = 1 : this.objData.diaSpage;
                this.objData.id = 9;       //传承人馆id = 8
                this.objData.num = 1;      //百科显示数据量为 1
                this._swiperData(this);  //页面加载完数据执行swiper
//                console.log(this.objData.diaSpage);
                //客户端存储num值   刷新当前页面
                this._refresh();
            },

            //页面加载完数据执行swiper
            _swiperData: function (_this, update) {
                this._getDias(_this.objData, function () {
                    _this.$nextTick(function () {
                        var mySwiper = new Swiper('.swiper-container_mmend', {
                            freeMode: true,
                            slidesPerView: 6
                        })

                        var mySwiper = new Swiper('.swiper-container_end', {
                            freeMode: true,
                            slidesPerView: 5
                            //slidesPerGroup : 3
                        })

                        if(update){
                           _this.defaultScroll();
                        }


                    })
                });
            },

            /**
             * @接收  当前点击的id
             * @private
             */
            _dataId: function (id) {
                var _this = this;
                this._initAll();          //点击百科取客户端缓存页数值
                this.objData.id = 9;      //传承人馆id = 8
                this.objData.num = 1;     //百科显示数据量为 1
                this.objData.atlasId = id;   //当前点击的ID

                this._getDias(this.objData, function () {
//                    console.log(_this.urlset)
                    _this.$nextTick(function() {
                        var mySwiper = new Swiper('.swiper-container', {
                            prevButton:'.swiper-button-prev',
                            nextButton:'.swiper-button-next',
                            pagination: '.swiper-pagination',
                            paginationType : 'fraction',
                            onSlideChangeEnd: function(swiper){
                                //alert(swiper.activeIndex);        //切换结束时，告诉我现在是第几个slide
                                var domVideo = $(".area .swiper-slide")[swiper.activeIndex];
                                var type = $(domVideo).attr("type");
                                if(type == 1){
                                    $(domVideo).find("video").trigger("play").parent().parent().siblings().find("video").trigger("pause");
                                    $(domVideo).find("span").hide().parent().parent().siblings().find("span").show();
                                }else{
                                    $(domVideo).siblings().find("video").trigger("pause");
                                    $(domVideo).siblings().find("span").show();
                                }
                                onloding($("#area img.lazy"));
                            }

                        })

                    })
                    onloding($("#area img.lazy"));
                })

            },


            //百科交互数据
            _getDias: function (objData, callback ) {

                this.dataList.forEach(function (val, index) {

                    if(val.code_id == 1){
                        val.ivmsg = true;
                    }else{
                        val.ivmsg = false;
                    }
                })

                this.ency = true;       //百科
                this.teac = false;      //教学
                this.acti = false;      //活动
                this.cons = false;      //咨询
                this.expe = false;      //体验馆
                this.inhe = false;      //传承人




                var _this = this;
                _this.msg = true;       //加载前显示

                var _url, data;
                //判断连接是否包含id传值
                var sliUrl = parseInt(window.location.href.split('?id=')[1]);
//                console.log("地址栏",sliUrl);

                if(!sliUrl){
                     _url = _this.urlIp;
                     data = {
                        objectId: objData.id,   //传承人馆ID
                        currPage: objData.diaSpage,   //页数
                        pageSize: objData.num    //数量/页
                    };
                    objData.msg = true;        //根据msg状态获取不同结构的数据 true: data[]   false: data{}
                    _this.leri = true;         //显示左右按钮
                }else{
                    _url = _this.urlId;
                    data = {
                        objectId: 9,   //传承人馆ID
                        targetId: sliUrl  //id
                    };
                    objData.msg = false;     //根据msg状态获取不同结构的数据 true: data[]   false: data{}
                    _this.leri = false;      //隐藏左右按钮
                }


//                console.log(data);

                getMuseumData(_url, data, function (obj) {

                    //当前博物馆的id
                    _this.basModelId = obj.basModelId;
                    //是否有数据total 1有  0无
                    _this.total = obj.total;
                    //题图数据导入
                    _this.bannerData = obj.banner;
                    //推荐传承人数据导入
                    _this.mmend = obj.area;
                    //标题
                    _this.musetitle = obj.muse;
                    //代表性传承人
                    _this.init.inher = obj.inherItor;
                    //非遗在中国
                    _this.China = obj.china;
                    //基本信息数据导入
                    _this.info = obj.info;


                    //图文 显示数据导入
                    _this.basData = obj.basData;
                    //右侧菜单
                    _this.listmenu = obj.listmenu;
                    //图集展示
                    _this.urlset = obj.urlset;

                    //传入分享内容
                    _this.share_content.title = _this.bannerData.title;  //标题
                    _this.share_content.imageUrl = 'https://general-h5.oss-cn-beijing.aliyuncs.com/images/icon-default.png';
                    _this.share_content.content = 'http://m.diich.com/info';
                    _this.share_content.htmlUrl = 'activate/museum.html?id='+ obj.shareId +'';  //当前页面链接



                    callback && callback(obj)            //swiper回调  post请求之后执行

                    _this.msg = false;                   //正在加载状态


//                    console.log('==========',_this.bannerData);



                    if(_this.total == 1 || _this.total == undefined){
                        _this.leri = false;
                    }else{
                        _this.leri = true;
                    }


                }, objData.atlasId, objData.msg);

            },


            //教学
            _getReset: function (objData, callback ) {

                var _this = this;
                _this.state = true;         //列表加载前显示
                _this.teacMsg = false;         //加载前隐藏load
                var _url = _this.allChannelIp;
                var data = {                //参数
                    objectId: objData.id,   //传承人馆ID
                    current: objData.page,   //页数
                    pageSize: objData.num,    //数量/页
                    parentId: _this.basModelId //当前传承人馆的ID
                };
//                console.log('data==========',_url, data);
                getResetData(_url, data, function (obj) {

                    //教学数据
                    if(_this.masStatus == 1){
                        _this.reset = _this.reset.concat(obj.reset);
                    }
                    if(_this.masStatus == 2){
                        _this.reset = obj.reset;
                    }

                    //是否有数据状态
                    _this.teacStatus = obj.status;

                    //将当期浏览的教学馆数据、数据状态、分页缓存本地
                    var objData = {
                        data: _this.reset,
                        status: _this.teacStatus,
                        objPage: _this.objData.page
                    };
                    //缓存本地
                    _setUpdata(objData);

                    callback && callback(obj)            //swiper回调  post请求之后执行

                    _this.state = false;         //列表加载后隐藏
                    _this.teacMsg = true;           //加载完成后显示load

//                    console.log("))))))))))))))",obj.reset);
                });

            },

            //活动
            _getActiva: function (objData, callback) {

                var _this = this;
                _this.state = true;         //加载前显示正在加载列表
                _this.actiMsg = false;         //加载前隐藏load
                var _url = _this.allChannelIp;   //接口
                var data = {                //参数
                    objectId: objData.id,   //传承人馆ID
                    current: objData.page,   //页数
                    pageSize: objData.num,    //数量/页
                    parentId: _this.basModelId //当前博物馆馆的ID
                };
//                console.log('data==========',_url, data);
                getActivaData(_url, data, function (obj) {
                    //资讯数据
                    if(_this.masStatus == 1){
                        _this.actiladd = _this.actiladd.concat(obj.actiladd);
                    }
                    if(_this.masStatus == 2){
                        _this.actiladd = obj.actiladd;
                    }

                    //是否有数据状态
                    _this.consActiva = obj.status;

                    //将当期浏览的活动数据、数据状态、分页缓存本地
                    var objData = {
                        data: _this.actiladd,
                        status: _this.consActiva,
                        objPage: _this.objData.page
                    };
                    //缓存本地
                    _setUpdata(objData);


                    callback && callback(obj)            //swiper回调  post请求之后执行
                    _this.state = false;         //加载后隐藏正在加载列表
                    _this.actiMsg = true;           //加载后显示load
                    console.log("活动::::::::::::",_this.actiladd);
                });
            },


            //资讯
            _getNewsData: function (objData, callback ) {
                var _this = this;

                _this.state = true;         //加载前显示正在加载列表
                _this.consMsg = false;         //加载前隐藏load
                var _url = _this.allChannelIp;   //接口
                var data = {                //参数
                    objectId: objData.id,   //传承人馆ID
                    current: objData.page,   //页数
                    pageSize: objData.num,    //数量/页
                    parentId: _this.basModelId //当前传承人馆的ID
                };
//                console.log('data==========',_url, data);
                getConsulData(_url, data, function (obj) {
                    //资讯数据
                    if(_this.masStatus == 1){
                        _this.newsData = _this.newsData.concat(obj.newsData);
                    }
                    if(_this.masStatus == 2){
                        _this.newsData = obj.newsData;
                    }

                    //是否有数据状态
                    _this.consStatus = obj.status;

                    //将当期浏览的资讯数据、数据状态、分页缓存本地
                    var objData = {
                        data: _this.newsData,
                        status: _this.consStatus,
                        objPage: _this.objData.page
                    };
                    //缓存本地
                    _setUpdata(objData);


                    callback && callback(obj)            //swiper回调  post请求之后执行
                    _this.state = false;         //加载后隐藏正在加载列表
                    _this.consMsg = true;           //加载后显示load
//                    console.log("))))))))))))))",_this.newsData);
                });
            },

            //体验馆
            _getExper: function (objData, callback ) {
                var _this = this;
                _this.state = true;         //列表加载前显示
                _this.expeMsg = false;         //加载完成前隐藏load
                var _url = _this.allChannelIp;
                var data = {                //参数
                    objectId: objData.id,   //传承人馆ID
                    current: objData.page,   //页数
                    pageSize: objData.num,    //数量/页
                    parentId: _this.basModelId //当前传承人馆的ID
                };
//                console.log('data==========',_url, data);
                getExperData(_url, data, function (obj) {

                    //教学数据
                    if(_this.masStatus == 1){
                        _this.reset = _this.reset.concat(obj.reset);
                    }
                    if(_this.masStatus == 2){
                        _this.reset = obj.reset;
                    }


                    //是否有数据状态
                    _this.expeStatus = obj.status;

                    //将当期浏览的体验馆数据、数据状态、分页缓存本地
                    var objData = {
                        data: _this.reset,
                        status: _this.expeStatus,
                        objPage: _this.objData.page
                    };
                    //缓存本地
                    _setUpdata(objData);

                    callback && callback(obj)            //swiper回调  post请求之后执行

                    _this.state = false;         //列表加载后隐藏
                    _this.expeMsg = true;           //加载完成后显示load

//                    console.log("))))))))))))))",obj.reset);
                });
            },

            //传承人
            _gethertor: function (objData, callback ) {
                var _this = this;

                _this.state = true;         //加载前显示正在加载列表
                _this.inheMsg = false;         //加载前隐藏load
                var _url = _this.allChannelIp;   //接口
                var data = {                //参数
                    objectId: objData.id,   //传承人馆ID
                    current: objData.page,   //页数
                    pageSize: objData.num,    //数量/页
                    parentId: _this.basModelId //当前传承人馆的ID
                };
//                console.log('data==========',_url, data);
                getHertorData(_url, data, function (obj) {
                    //资讯数据
                    if(_this.masStatus == 1){
                        _this.hertor = _this.hertor.concat(obj.hertor);
                    }
                    if(_this.masStatus == 2){
                        _this.hertor = obj.hertor;
                    }

                    //是否有数据状态
                    _this.inheStatus = obj.status;

                    //将当期浏览的传承人数据、数据状态、分页缓存本地
                    var objData = {
                        data: _this.hertor,
                        status: _this.inheStatus,
                        objPage: _this.objData.page
                    };
                    //缓存本地
                    _setUpdata(objData);


                    callback && callback(obj)            //swiper回调  post请求之后执行
                    _this.state = false;         //加载后隐藏正在加载列表
                    _this.inheMsg = true;           //加载后显示load
//                    console.log("))))))))))))))",_this.hertor);
                });
            },







            //禁止滑动
            hidden(thisTop) {
                var scrollTop = window.pageYOffset
                    || document.documentElement.scrollTop
                    || document.body.scrollTop
                    || 0;
                document.body.style.top = "-" + thisTop + "px";
                document.body.style.position = 'fixed';
                //console.log(thisTop);
            },
            //解除禁止滚动
            show(thisTop) {
                document.body.style.overflow='';
                document.body.style.position=null;
                document.body.style.top=null;
                window.scrollTo(0,thisTop);
            },


            //滚动事件
            handleScroll(){
                var top = $(window).scrollTop();
                this.hiddenTop = top;

                localStorage.setItem("handleScroll", top);
            },

            //取滚动的默认高度 和 默认展示的频道
            defaultScroll: function () {
                var StrScroll = localStorage.getItem("handleScroll");
                var defaultScroll = Number(StrScroll);
                $("html, body").scrollTop(defaultScroll);
                window.addEventListener('scroll',this.handleScroll);
            },

            //存储当前点击的频道
            default_channel: function (index) {
                localStorage.setItem("default-channel",index);
            },


        },
        updated: function() {
            // 懒加载
            var self = this;
            self.$nextTick(function() {
                $("#mescroll").trigger('scroll');
                onloding($("img.lazy"));
            })
        },
        mounted: function () {

            var _this = this;
            //分享后的页面导航显示
            callApp(null,function () {
                if(_htmlShear() == true){
                    //分享后的页面清除缓存
                    removeLost();
                    //显示分享后的导航 隐藏原导航
                    _this.head.apphead = true;
                    _this.head.h5head = false;
                }else{
                    //显示原导航  隐藏分享后的导航
                    _this.head.apphead = false;
                    _this.head.h5head = true;
                }
            });


            window.addEventListener('scroll',this.handleScroll);
            //获取存储的默认频道
            var channel = localStorage.getItem("default-channel");



            //获取默认页数
            this._initAll();
            this.objData.id = 9;
            this.objData.num = 1;


            switch (channel){
                case "0":                //默认百科频道
                    _this._swiperData(_this, true);
                    break;
                case "1":                //默认教学频道
                    _this._getDias(_this.objData, function () {
                        _this.$nextTick(function () {
                            var mySwiper = new Swiper('.swiper-container_mmend', {
                                freeMode: true,
                                slidesPerView: 6
                            })

                            var mySwiper = new Swiper('.swiper-container_end', {
                                freeMode: true,
                                slidesPerView: 5
                                //slidesPerGroup : 3
                            })

                            _this.ency = false;       //百科
                            _this.teac = true;        //教学
                            _this.acti = false;       //活动
                            _this.cons = false;       //咨询
                            _this.expe = false;       //体验馆
                            _this.inhe = false;       //传承人
                            _this.dataList.forEach(function (val, index) {
                                if(val.code_id == 2){
                                    val.ivmsg = true;
                                }else{
                                    val.ivmsg = false;
                                }
                            })


                            if(_getUpdata()){
                                _this.reset = _getUpdata().data;
                                _this.teacStatus = _getUpdata().status;
                                _this.objData.page = _getUpdata().objPage;
                                _this.teacMsg = true;
                                $(function () {
                                    _this.defaultScroll();
                                })
                            }else {
                                _this.objData.id = 16;
                                _this.objData.page = 1;
                                _this.objData.num = 5;
                                _this.masStatus = 2;   //不累加
                                _this._getReset(this.objData, function () {
                                    $(function () {
                                        _this.defaultScroll();
                                    })
                                });
                            }





                        })
                    });
                    break;
                case "2":                //默认活动频道
                    _this._getDias(_this.objData, function () {
                        _this.$nextTick(function () {
                            var mySwiper = new Swiper('.swiper-container_mmend', {
                                freeMode: true,
                                slidesPerView: 6
                            })

                            var mySwiper = new Swiper('.swiper-container_end', {
                                freeMode: true,
                                slidesPerView: 5
                                //slidesPerGroup : 3
                            })

                            _this.ency = false;       //百科
                            _this.teac = false;       //教学
                            _this.acti = true;        //活动
                            _this.cons = false;       //咨询
                            _this.expe = false;       //体验馆
                            _this.inhe = false;       //传承人
                            _this.dataList.forEach(function (val, index) {
                                if(val.code_id == 3){
                                    val.ivmsg = true;
                                }else{
                                    val.ivmsg = false;
                                }
                            })

                            if(_getUpdata()){
                                _this.actiladd = _getUpdata().data;
                                _this.consActiva = _getUpdata().status;
                                _this.objData.page = _getUpdata().objPage;
                                _this.actiMsg = true;
                                $(function () {
                                    _this.defaultScroll();
                                })
                            }else {
                                _this.objData.id = 17;
                                _this.objData.page = 1;
                                _this.objData.num = 5;
                                _this.masStatus = 2;   //不累加
                                _this._getActiva(this.objData, function () {
                                    $(function () {
                                        _this.defaultScroll();
                                    })
                                });
                            }





                        })
                    });
                    break;
                case "3":                //默认资讯频道
                    _this._getDias(_this.objData, function () {
                        _this.$nextTick(function () {
                            var mySwiper = new Swiper('.swiper-container_mmend', {
                                freeMode: true,
                                slidesPerView: 6
                            })

                            var mySwiper = new Swiper('.swiper-container_end', {
                                freeMode: true,
                                slidesPerView: 5
                                //slidesPerGroup : 3
                            })

                            _this.ency = false;       //百科
                            _this.teac = false;       //教学
                            _this.acti = false;       //活动
                            _this.cons = true;        //咨询
                            _this.expe = false;       //体验馆
                            _this.inhe = false;       //传承人
                            _this.dataList.forEach(function (val, index) {
                                if(val.code_id == 4){
                                    val.ivmsg = true;
                                }else{
                                    val.ivmsg = false;
                                }
                            })


                            if(_getUpdata()){
                                _this.newsData = _getUpdata().data;
                                _this.consStatus = _getUpdata().status;
                                _this.objData.page = _getUpdata().objPage;
                                _this.consMsg = true;
                                $(function () {
                                    _this.defaultScroll();
                                })
                            }else {
                                _this.objData.id = 18;
                                _this.objData.page = 1;
                                _this.objData.num = 5;
                                _this.masStatus = 2;   //不累加

                                _this._getNewsData(this.objData, function () {
                                    $(function () {
                                        _this.defaultScroll();
                                    })
                                });
                            }



                        })
                    });
                    break;
                case "4":                //默认体验馆频道
                    _this._getDias(_this.objData, function () {
                        _this.$nextTick(function () {
                            var mySwiper = new Swiper('.swiper-container_mmend', {
                                freeMode: true,
                                slidesPerView: 6
                            })

                            var mySwiper = new Swiper('.swiper-container_end', {
                                freeMode: true,
                                slidesPerView: 5
                                //slidesPerGroup : 3
                            })

                            _this.ency = false;       //百科
                            _this.teac = false;       //教学
                            _this.acti = false;       //活动
                            _this.cons = false;       //咨询
                            _this.expe = true;      //体验馆
                            _this.inhe = false;       //传承人
                            _this.dataList.forEach(function (val, index) {
                                if(val.code_id == 5){
                                    val.ivmsg = true;
                                }else{
                                    val.ivmsg = false;
                                }
                            });


                            if(_getUpdata()){
                                _this.reset = _getUpdata().data;
                                _this.expeStatus = _getUpdata().status;
                                _this.objData.page = _getUpdata().objPage;
                                _this.expeMsg = true;
                                $(function () {
                                    _this.defaultScroll();
                                })
                            }else {
                                _this.objData.id = 19;
                                _this.objData.page = 1;
                                _this.objData.num = 5;
                                _this.masStatus = 2;   //不累加
                                _this._getExper(this.objData, function () {
                                    $(function () {
                                        _this.defaultScroll();
                                    })
                                });

                            }



                        })
                    });
                    break;
                case "5":                //默认传承人频道
                    _this._getDias(_this.objData, function () {
                        _this.$nextTick(function () {
                            var mySwiper = new Swiper('.swiper-container_mmend', {
                                freeMode: true,
                                slidesPerView: 6
                            })

                            var mySwiper = new Swiper('.swiper-container_end', {
                                freeMode: true,
                                slidesPerView: 5
                                //slidesPerGroup : 3
                            })

                            _this.ency = false;       //百科
                            _this.teac = false;       //教学
                            _this.acti = false;       //活动
                            _this.cons = false;       //咨询
                            _this.expe = false;       //体验馆
                            _this.inhe = true;        //传承人
                            _this.dataList.forEach(function (val, index) {
                                if(val.code_id == 6){
                                    val.ivmsg = true;
                                }else{
                                    val.ivmsg = false;
                                }
                            })



                            if(_getUpdata()){
                                _this.hertor = _getUpdata().data;
                                _this.inheStatus = _getUpdata().status;
                                _this.objData.page = _getUpdata().objPage;
                                _this.inheMsg = true;
                                $(function () {
                                    _this.defaultScroll();
                                })
                            }else {
                                _this.objData.id = 20;
                                _this.objData.page = 1;
                                _this.objData.num = 5;
                                _this.masStatus = 2;   //不累加
                                _this._gethertor(this.objData, function () {
                                    $(function () {
                                        _this.defaultScroll();
                                    })
                                });
                            }






                        })
                    });
                    break;
                default:
                    _this._swiperData(_this, true);
            }


            // 五秒后
            setTimeout(function () {
                if (_this.msg) {
                    _this.load_msg.shopMsg = true;
                    _this.load_msg.networkMsg = true;
                    _this.load_msg.btn_msg = true;
                    _this.load_msg.returnMsg = true;
                } else {
                    _this.load_msg.shopMsg = false;
                    _this.load_msg.networkMsg = false;
                    _this.load_msg.btn_msg = false;
                    _this.load_msg.returnMsg = false;
                }
            },overTime)

        }
    })




</script>

<script type="text/javascript" src="../../cordova.js"></script>

</body>
</html>